# Устранение проблем с разрешениями macOS

## Проблема: Транскрибация происходит, но текст не появляется в приложении

Если транскрибация работает (микрофон записывает), но текст не отображается в интерфейсе, проверьте следующие настройки:

## 1. Разрешения на микрофон

### Как проверить:
1. Откройте **Системные настройки** (System Settings) или **Системные параметры** (System Preferences)
2. Перейдите в **Конфиденциальность и безопасность** (Privacy & Security)
3. Выберите **Микрофон** (Microphone)
4. Убедитесь, что **ASAApp** присутствует в списке и включен (галочка установлена)

### Если приложения нет в списке:
1. Запустите ASAApp
2. При первом использовании микрофона macOS должен показать диалог запроса разрешения
3. Нажмите **"Разрешить"** или **"Allow"**

### Если диалог не появился:
1. Удалите приложение из списка разрешений (если оно там есть)
2. Полностью закройте ASAApp (Cmd+Q)
3. Запустите приложение снова
4. Попробуйте использовать микрофон - диалог должен появиться

## 2. Разрешения на доступность (Accessibility)

Эти разрешения нужны для автоматического захвата кликов:

### Как проверить:
1. Откройте **Системные настройки** → **Конфиденциальность и безопасность**
2. Выберите **Доступность** (Accessibility)
3. Убедитесь, что **ASAApp** присутствует в списке и включен

### Если приложения нет:
1. Запустите ASAApp
2. Включите функцию "Auto-click Capture" в приложении
3. macOS должен показать диалог запроса разрешения
4. Нажмите **"Открыть настройки"** (Open Settings)
5. Добавьте ASAApp в список разрешенных приложений
6. **ВАЖНО**: Полностью закройте и перезапустите ASAApp после добавления

## 3. Проверка через терминал

Вы можете проверить разрешения через терминал:

```bash
# Проверить разрешения на микрофон
tccutil reset Microphone com.asaapp.ASAApp

# Проверить разрешения на доступность
tccutil reset Accessibility com.asaapp.ASAApp
```

После выполнения этих команд перезапустите приложение.

## 4. Проверка подписи кода и entitlements

Убедитесь, что приложение правильно собрано с entitlements:

1. Проверьте наличие файла `ASAApp.app/Contents/Resources/ASAApp.entitlements`
2. Проверьте наличие `NSMicrophoneUsageDescription` в `Info.plist`

## 5. Проверка логов

Если проблема сохраняется, проверьте логи приложения:

```bash
# Просмотр логов в реальном времени
log stream --predicate 'subsystem == "ASAApp"' --level debug

# Или через Console.app
open -a Console
```

## 6. Полный сброс разрешений

Если ничего не помогает:

1. Полностью закройте ASAApp
2. Выполните в терминале:
```bash
tccutil reset All com.asaapp.ASAApp
```
3. Перезапустите приложение
4. Предоставьте все разрешения заново

## Частые проблемы

### Проблема: Приложение не запрашивает разрешения
**Решение**: Убедитесь, что в `Info.plist` присутствуют ключи:
- `NSMicrophoneUsageDescription`
- `NSCameraUsageDescription` (если используется)

### Проблема: Разрешения предоставлены, но не работают
**Решение**: 
1. Полностью закройте приложение (Cmd+Q)
2. Перезапустите приложение
3. macOS применяет разрешения только после перезапуска

### Проблема: Транскрибация работает, но текст не появляется
**Решение**:
1. Проверьте логи на наличие ошибок
2. Убедитесь, что UI обновляется на главном потоке
3. Проверьте, что `userInput` правильно связан с `TextEditor` в SwiftUI

## Контакты и дополнительная помощь

Если проблема не решается, проверьте:
- Версию macOS (требуется macOS 13.0+)
- Правильность сборки приложения через `swift-build-ASAapp.sh`
- Наличие всех необходимых зависимостей

